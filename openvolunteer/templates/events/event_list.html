{% extends "base.html" %}

{% block title %}
  Events
{% endblock title %}
{% block content %}
  {# ================= HEADER ================= #}
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="mb-0">Events</h1>
      <div class="text-muted small">View and manage events for your organizations</div>
    </div>
    {% if can_create_event %}
      <a href="{% url 'events:event_create' %}" class="btn btn-primary">+ Add Event</a>
    {% endif %}
  </div>
  {# ================= EVENT TABLE ================= #}
  {% include "components/filters.html" %}
  {% if events %}
    <div class="card shadow-sm">
      <div class="table-responsive">
        <table class="table table-hover mb-0 align-middle">
          <thead class="table-light">
            <tr>
              <th>Event</th>
              <th>Date</th>
              <th>Organization</th>
              <th>Owner</th>
              <th>Type</th>
              <th>Status</th>
              <th class="text-end">Shifts</th>
            </tr>
          </thead>
          <tbody>
            {% for event in events %}
              <tr>
                <td>
                  <a href="{% url 'events:event_detail' event.id %}"
                     class="fw-semibold text-decoration-none">{{ event.title }}</a>
                  {% if event.description %}<div class="text-muted small">{{ event.description|truncatewords:15 }}</div>{% endif %}
                </td>
                <td class="text-muted small">
                  {% with start=event.starts_at end=event.ends_at %}
                    {% include "components/datetime_range.html" %}
                  {% endwith %}
                </td>
                <td>{{ event.org.name }}</td>
                <td>
                  {% if event.owned_by %}
                    {{ event.owned_by.name|default:event.owned_by.username }}
                  {% else %}
                    <span class="text-muted">â€”</span>
                  {% endif %}
                </td>
                <td>{{ event.get_event_type_display }}</td>
                <td>
                  <span class="badge {% if event.event_status == 'draft' %} bg-secondary {% elif event.event_status == 'published' %} bg-success {% else %} bg-light text-dark {% endif %} ">
                    {{ event.get_event_status_display }}
                  </span>
                </td>
                <td class="text-end">
                  {% with shift_count=event.visible_shifts.count %}
                    {% if shift_count %}
                      <span class="badge bg-light text-dark">{{ shift_count }}</span>
                    {% else %}
                      <span class="text-muted">0</span>
                    {% endif %}
                  {% endwith %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    {% include "components/pagination.html" %}
  {% else %}
    <div class="card shadow-sm">
      <div class="card-body text-center py-5">
        <h5 class="mb-2">No events yet</h5>
        <p class="text-muted mb-3">Get started by creating your first event.</p>
        {% if can_create_event %}
          <a href="{% url 'events:event_create' %}" class="btn btn-primary">+ Add Event</a>
        {% endif %}
      </div>
    </div>
  {% endif %}
{% endblock content %}
