{% extends "base.html" %}

{% block title %}
  {% if is_edit %}
    Edit Person
  {% else %}
    Add Person
  {% endif %}
{% endblock title %}
{% block content %}
  <div class="mb-3">
    <a href="{% url 'people:person_list' %}">‚Üê Back to people</a>
  </div>
  <h1 class="mb-4">
    {% if is_edit %}
      Edit Person
    {% else %}
      Add Person
    {% endif %}
  </h1>
  <form method="post" class="row g-4">
    {% csrf_token %}
    {{ form.non_field_errors }}
    <!-- BASIC INFO -->
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header">
          <strong>Basic Info</strong>
        </div>
        <div class="card-body row g-3">
          <div class="col-md-6">
            {{ form.full_name.label_tag }}
            {{ form.full_name }}
            {{ form.full_name.errors }}
          </div>
          <div class="col-md-6">
            {{ form.discord.label_tag }}
            {{ form.discord }}
            {{ form.discord.errors }}
          </div>
          <div class="col-md-6">
            {{ form.email.label_tag }}
            {{ form.email }}
            {{ form.email.errors }}
          </div>
          <div class="col-md-6">
            {{ form.phone.label_tag }}
            {{ form.phone }}
            {{ form.phone.errors }}
          </div>
        </div>
      </div>
    </div>
    <!-- ADDRESS -->
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header">
          <strong>Address</strong>
        </div>
        <div class="card-body row g-3">
          <div class="col-12">
            {{ form.address_line1.label_tag }}
            {{ form.address_line1 }}
          </div>
          <div class="col-12">
            {{ form.address_line2.label_tag }}
            {{ form.address_line2 }}
          </div>
          <div class="col-md-4">
            {{ form.city.label_tag }}
            {{ form.city }}
          </div>
          <div class="col-md-4">
            {{ form.state.label_tag }}
            {{ form.state }}
          </div>
          <div class="col-md-4">
            {{ form.postal_code.label_tag }}
            {{ form.postal_code }}
          </div>
        </div>
      </div>
    </div>
    <!-- TAGS -->
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header">
          <strong>Tags</strong>
        </div>
        <div class="card-body">
          <label class="form-label">Tags</label>
          <div>
            {% for tag in form.fields.tags.queryset %}
              <label class="ov-tag-toggle">
                <input type="checkbox"
                       name="tags"
                       value="{{ tag.id }}"
                       {% if tag.id in selected_tag_ids %}checked{% endif %} />
                <span class="tag-pill" style="--tag-color: {{ tag.color_hex }};">{{ tag.name }}</span>
              </label>
            {% endfor %}
          </div>
          {{ form.tags.errors }}
          <div class="form-text mt-2">Click tags to add or remove them from this person.</div>
        </div>
      </div>
    </div>
    <!-- ORGANIZATIONS -->
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header">
          <strong>Organizations</strong>
        </div>
        <div class="card-body">
          <label class="form-label">Organizations</label>
          <div>
            {% for org in form.fields.organizations.queryset %}
              <label class="ov-tag-toggle">
                <input type="checkbox"
                       name="organizations"
                       value="{{ org.id }}"
                       {% if org.id in selected_org_ids %}checked{% endif %} />
                <span class="ov-tag ov-tag-org">{{ org.name }}</span>
              </label>
            {% endfor %}
          </div>
          {{ form.organizations.errors }}
          <div class="form-text mt-2">Click organizations to add or remove this person.</div>
        </div>
      </div>
    </div>
    <!-- ATTRIBUTES -->
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header">
          <strong>Custom Attributes</strong>
        </div>
        <div class="card-body">
          {{ form.attributes.label_tag }}
          {{ form.attributes }}
          <div class="form-text">
            Optional JSON (e.g. <code>{"support_level": "strong"}</code>)
          </div>
        </div>
      </div>
    </div>
    <!-- ACTIONS -->
    <div class="col-12 d-flex justify-content-end gap-2">
      <a href="{% url 'people:person_list' %}"
         class="btn btn-outline-secondary">Cancel</a>
      <button type="submit" class="btn btn-primary">
        {% if is_edit %}
          Save Changes
        {% else %}
          Create Person
        {% endif %}
      </button>
    </div>
  </form>
{% endblock content %}
